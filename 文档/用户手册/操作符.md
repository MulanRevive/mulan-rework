## 重载操作符语法范式

此语法实现在类型中重载操作符，默认算定义的类型不支持标准的操作符，
重载会实现相应的功能，[示例](../../测试/类型/操作符/定义操作符.ul)。
除实现原操作符功能外，还可以修改为其它功能，比如把a+3 的语义变成a的3次幂。
```
// 示例样式
type TypeName {
    func $TypeName(param) {
        self.value = param
    }
    
    // operator : OPERATOR binop ( param , param ) block
    operator 二元操作符 (参数) {
        // 实现部分
        return ...
    }
    
    // operator : OPERATOR uop op_none block
    operator 一元操作符 {
        // 实现部分
        return ...
    }
    
    // operator : OPERATOR - op_none block
    operator - {
        // 实现部分
        return ...
    }
}
```

> 支持重载的操作符见 [语法说明](../语法说明.md) 的 “二元操作符”与 “一元操作符” 部分。

### 操作符“[]”重载问题
重载[]时需要重载单参数和双参数，单参数取值，双参数设置值。

重载方式，单操作符为：
`operator [] (v) {...}`
含义为取第v项的值。

双参数为： 
`operator [] (v1, v2) {...}`
含义为设置v1项的值为v2。

### 操作符“减”的问题
当做减运算时使用二元操作符方式重载：
`operator - (v) {...}`

当做为负号运算符重载时，使用无操作数方式重载：
`operator - {...}`

另外做为负时不能使用 `operator - () {...}`这种方式重载，
原因待研究，把小括号优先级放点点之后，使用当前语法会报语法错误'没认出这个词 ")" '，
与原始木兰行为相同；如果将其置于最后，则运行无误。但是重载减法带参数操作符则报错。

开发中找到了不两种方式都可以的实现：
```python
    @分析器母机.语法规则(语法.操作符.成分(名词_操作符, 语法.二元操作符, 语法.操作数, 语法.块))
    def 操作符(self, 片段):
+        if 片段[1] == '__sub__' and len(片段[2].args) == 1:
+            片段[1] = '__neg__'
        return 语法树.新节点(
            语法.函数, 名称=片段[1],
            参数=片段[2],
            主体=片段[-1],
            片段=片段)

    @分析器母机.语法规则(语法.操作数.成分(前小括号, 语法.形参, 后小括号))
+    @分析器母机.语法规则(语法.操作数.成分(前小括号, 后小括号))
+    @分析器母机.语法规则(语法.操作数.成分(语法.形参))
    def 操作数(self, 片段):
        各形参 = self.形参列表()
        各形参.args.append(
            语法树.新节点(
                语法.操作数, 参数='self',
                片段=片段))
        [各形参.args.append(形参) for 形参 in 片段 if isinstance(形参, ast.arg)]
        return 各形参
```
带加行为实现过程，无理就是把负也当成二元操作符，判断无参数就把语法替换为负 `__neg__` 。
